#!/bin/bash
# bazinga - Main entry point for BAZINGA system
# Part of the BAZINGA Project
# https://github.com/abhissrivasta/BAZINGA

# Colors for better output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Find BAZINGA directory
SCRIPT_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
BAZINGA_DIR="$(dirname "$SCRIPT_DIR")"

# Print banner
print_banner() {
  echo -e "${BLUE}"
  echo '╔══════════════════════════════════════════════════════════════════════════╗'
  echo '║  ██████╗  █████╗ ███████╗██╗███╗   ██╗ ██████╗  █████╗                  ║'
  echo '║  ██╔══██╗██╔══██╗╚══███╔╝██║████╗  ██║██╔════╝ ██╔══██╗                 ║'
  echo '║  ██████╔╝███████║  ███╔╝ ██║██╔██╗ ██║██║  ███╗███████║                 ║'
  echo '║  ██╔══██╗██╔══██║ ███╔╝  ██║██║╚██╗██║██║   ██║██╔══██║                 ║'
  echo '║  ██████╔╝██║  ██║███████╗██║██║ ╚████║╚██████╔╝██║  ██║                 ║'
  echo '║  ╚═════╝ ╚═╝  ╚═╝╚══════╝╚═╝╚═╝  ╚═══╝ ╚═════╝ ╚═╝  ╚═╝                 ║'
  echo '╚══════════════════════════════════════════════════════════════════════════╝'
  echo -e "${NC}"
  echo -e "${CYAN}Bazaar-Inspired Neural Growth and Analysis${NC}"
  echo -e "${YELLOW}⟨ψ|⟳|The framework recognizes patterns that recognize themselves being recognized⟩${NC}"
  echo ""
}

# Show help menu
show_help() {
  echo -e "Usage: bazinga [command] [options]"
  echo -e ""
  echo -e "Commands:"
  echo -e "  ${GREEN}analyze${NC}    Analyze a codebase or dataset"
  echo -e "  ${GREEN}quantum${NC}    Run quantum linguistics analysis"
  echo -e "  ${GREEN}pattern${NC}    Work with pattern recognition systems"
  echo -e "  ${GREEN}integrate${NC}  Integrate with external systems"
  echo -e "  ${GREEN}generate${NC}   Generate reports or visualizations"
  echo -e "  ${GREEN}setup${NC}      Set up or configure the system"
  echo -e "  ${GREEN}help${NC}       Show this help message"
  echo -e ""
  echo -e "Examples:"
  echo -e "  bazinga analyze /path/to/codebase"
  echo -e "  bazinga quantum --depth=3 --output=report.md"
  echo -e "  bazinga pattern detect --source=data.json"
  echo -e ""
  echo -e "For more information, see the documentation in the docs/ directory."
}

# Check environment and dependencies
check_environment() {
  local all_good=true
  
  # Check Node.js
  if ! command -v node &> /dev/null; then
    echo -e "${RED}Error: Node.js is not installed${NC}"
    all_good=false
  fi
  
  # Check Python
  if ! command -v python3 &> /dev/null; then
    echo -e "${RED}Error: Python 3 is not installed${NC}"
    all_good=false
  fi
  
  # Check essential directories
  for dir in "bin" "lib" "config"; do
    if [ ! -d "$BAZINGA_DIR/$dir" ]; then
      echo -e "${RED}Error: Required directory $dir is missing${NC}"
      all_good=false
    fi
  done
  
  if [ "$all_good" = false ]; then
    echo -e "${YELLOW}Run 'bazinga setup' to fix these issues${NC}"
    return 1
  fi
  
  return 0
}

# Dispatch command to the appropriate script
dispatch_command() {
  local command="$1"
  shift
  
  case "$command" in
    "analyze")
      if [ -x "$BAZINGA_DIR/bin/bazinga-analyzer.sh" ]; then
        "$BAZINGA_DIR/bin/bazinga-analyzer.sh" "$@"
      elif [ -x "$BAZINGA_DIR/quantum-architecture-analyzer.sh" ]; then
        "$BAZINGA_DIR/quantum-architecture-analyzer.sh" "$@"
      else
        echo -e "${RED}Error: Analyzer script not found${NC}"
        return 1
      fi
      ;;
    "quantum")
      if [ -x "$BAZINGA_DIR/system/bazinga-quantum" ]; then
        "$BAZINGA_DIR/system/bazinga-quantum" "$@"
      else
        echo -e "${RED}Error: Quantum script not found${NC}"
        return 1
      fi
      ;;
    "pattern")
      if [ -x "$BAZINGA_DIR/bin/bazinga-pattern-recognition.sh" ]; then
        "$BAZINGA_DIR/bin/bazinga-pattern-recognition.sh" "$@"
      else
        echo -e "${RED}Error: Pattern recognition script not found${NC}"
        return 1
      fi
      ;;
    "integrate")
      if [ -x "$BAZINGA_DIR/bin/bazinga-integration.sh" ]; then
        "$BAZINGA_DIR/bin/bazinga-integration.sh" "$@"
      else
        echo -e "${RED}Error: Integration script not found${NC}"
        return 1
      fi
      ;;
    "generate")
      if [ -x "$BAZINGA_DIR/bin/bazinga-generator.sh" ]; then
        "$BAZINGA_DIR/bin/bazinga-generator.sh" "$@"
      else
        echo -e "${RED}Error: Generator script not found${NC}"
        return 1
      fi
      ;;
    "setup")
      if [ -x "$BAZINGA_DIR/bin/bazinga-setup.sh" ]; then
        "$BAZINGA_DIR/bin/bazinga-setup.sh" "$@"
      else
        echo -e "${RED}Error: Setup script not found${NC}"
        return 1
      fi
      ;;
    "help")
      show_help
      ;;
    *)
      echo -e "${RED}Error: Unknown command '$command'${NC}"
      show_help
      return 1
      ;;
  esac
}

# Main function
main() {
  print_banner
  
  # No arguments, show help
  if [ $# -eq 0 ]; then
    show_help
    return 0
  fi
  
  # Check environment
  check_environment
  
  # Dispatch command
  dispatch_command "$@"
}

# Execute main function
main "$@"
